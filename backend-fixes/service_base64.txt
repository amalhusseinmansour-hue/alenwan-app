<?php

namespace App\Services;

use App\Models\Movie;
use App\Models\Series;
use Illuminate\Support\Facades\Http;
use Illuminate\Support\Facades\Log;
use Illuminate\Support\Str;

class OmdbImportService
{
    protected string $apiKey = '2379d837';
    protected string $baseUrl = 'https://www.omdbapi.com/';

    /**
     * Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ø­ØªÙˆÙ‰ ÙÙŠ OMDB
     */
    public function search(string $query, string $type = '', int $page = 1): array
    {
        try {
            $params = [
                'apikey' => $this->apiKey,
                's' => $query,
                'page' => $page,
            ];

            if ($type) {
                $params['type'] = $type; // movie, series, episode
            }

            $response = Http::get($this->baseUrl, $params);

            if ($response->successful()) {
                $data = $response->json();

                if ($data['Response'] === 'True') {
                    return [
                        'success' => true,
                        'results' => $data['Search'] ?? [],
                        'totalResults' => (int)($data['totalResults'] ?? 0),
                    ];
                }
            }

            return [
                'success' => false,
                'error' => $data['Error'] ?? 'ÙØ´Ù„ Ø§Ù„Ø¨Ø­Ø«',
            ];

        } catch (\Exception $e) {
            Log::error('OMDB Search Error: ' . $e->getMessage());
            return [
                'success' => false,
                'error' => $e->getMessage(),
            ];
        }
    }

    /**
     * Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØªÙØ§ØµÙŠÙ„ ÙƒØ§Ù…Ù„Ø© Ù„ÙÙŠÙ„Ù…/Ù…Ø³Ù„Ø³Ù„
     */
    public function getDetails(string $imdbId): array
    {
        try {
            $response = Http::get($this->baseUrl, [
                'apikey' => $this->apiKey,
                'i' => $imdbId,
                'plot' => 'full',
            ]);

            if ($response->successful()) {
                $data = $response->json();

                if ($data['Response'] === 'True') {
                    return [
                        'success' => true,
                        'data' => $data,
                    ];
                }
            }

            return [
                'success' => false,
                'error' => $data['Error'] ?? 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø­ØªÙˆÙ‰',
            ];

        } catch (\Exception $e) {
            Log::error('OMDB Details Error: ' . $e->getMessage());
            return [
                'success' => false,
                'error' => $e->getMessage(),
            ];
        }
    }

    /**
     * Ø§Ø³ØªÙŠØ±Ø§Ø¯ ÙÙŠÙ„Ù… Ù…Ù† OMDB Ø¥Ù„Ù‰ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
     */
    public function importMovie(string $imdbId, int $categoryId, int $languageId = 1): ?Movie
    {
        try {
            $result = $this->getDetails($imdbId);

            if (!$result['success']) {
                throw new \Exception($result['error']);
            }

            $data = $result['data'];

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø§Ù„ÙÙŠÙ„Ù… Ù…Ø³Ø¨Ù‚Ø§Ù‹
            $existingMovie = Movie::where('imdb_id', $imdbId)->first();
            if ($existingMovie) {
                return $existingMovie;
            }

            // ØªØ­Ø¶ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            $movieData = [
                'imdb_id' => $imdbId,
                'category_id' => $categoryId,
                'language_id' => $languageId,
                'title' => [
                    'ar' => $data['Title'] ?? 'Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†',
                    'en' => $data['Title'] ?? 'Untitled',
                ],
                'description' => [
                    'ar' => $data['Plot'] ?? 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ',
                    'en' => $data['Plot'] ?? 'No description',
                ],
                'slug' => Str::slug($data['Title'] ?? 'movie-' . time()),
                'year' => $this->extractYear($data['Year'] ?? ''),
                'duration' => $this->extractDuration($data['Runtime'] ?? ''),
                'rating' => $this->extractRating($data['imdbRating'] ?? '0'),
                'poster' => $this->getPosterUrl($data['Poster'] ?? ''),
                'trailer_url' => null, // ÙŠØ¬Ø¨ Ø¥Ø¶Ø§ÙØªÙ‡ ÙŠØ¯ÙˆÙŠØ§Ù‹
                'video_url' => null, // ÙŠØ¬Ø¨ Ø¥Ø¶Ø§ÙØªÙ‡ ÙŠØ¯ÙˆÙŠØ§Ù‹
                'director' => [
                    'ar' => $data['Director'] ?? 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ',
                    'en' => $data['Director'] ?? 'Unknown',
                ],
                'cast' => $data['Actors'] ?? '',
                'genres' => $data['Genre'] ?? '',
                'is_active' => true,
                'is_premium' => false,
                'is_featured' => false,
                'views_count' => 0,
            ];

            $movie = Movie::create($movieData);

            Log::info("Movie imported from OMDB: {$movie->title} (IMDb: {$imdbId})");

            return $movie;

        } catch (\Exception $e) {
            Log::error('OMDB Import Movie Error: ' . $e->getMessage());
            return null;
        }
    }

    /**
     * Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ø³Ù„Ø³Ù„ Ù…Ù† OMDB Ø¥Ù„Ù‰ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
     */
    public function importSeries(string $imdbId, int $categoryId, int $languageId = 1): ?Series
    {
        try {
            $result = $this->getDetails($imdbId);

            if (!$result['success']) {
                throw new \Exception($result['error']);
            }

            $data = $result['data'];

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù†Ù‡ Ù…Ø³Ù„Ø³Ù„
            if ($data['Type'] !== 'series') {
                throw new \Exception('Ù‡Ø°Ø§ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù„ÙŠØ³ Ù…Ø³Ù„Ø³Ù„Ø§Ù‹');
            }

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù…Ø³Ù„Ø³Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹
            $existingSeries = Series::where('imdb_id', $imdbId)->first();
            if ($existingSeries) {
                return $existingSeries;
            }

            // ØªØ­Ø¶ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            $seriesData = [
                'imdb_id' => $imdbId,
                'category_id' => $categoryId,
                'language_id' => $languageId,
                'title' => [
                    'ar' => $data['Title'] ?? 'Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†',
                    'en' => $data['Title'] ?? 'Untitled',
                ],
                'description' => [
                    'ar' => $data['Plot'] ?? 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ',
                    'en' => $data['Plot'] ?? 'No description',
                ],
                'slug' => Str::slug($data['Title'] ?? 'series-' . time()),
                'year' => $this->extractYear($data['Year'] ?? ''),
                'rating' => $this->extractRating($data['imdbRating'] ?? '0'),
                'poster' => $this->getPosterUrl($data['Poster'] ?? ''),
                'trailer_url' => null,
                'director' => [
                    'ar' => $data['Director'] ?? 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ',
                    'en' => $data['Director'] ?? 'Unknown',
                ],
                'cast' => $data['Actors'] ?? '',
                'genres' => $data['Genre'] ?? '',
                'total_seasons' => (int)($data['totalSeasons'] ?? 0),
                'is_active' => true,
                'is_premium' => false,
                'is_featured' => false,
                'views_count' => 0,
            ];

            $series = Series::create($seriesData);

            Log::info("Series imported from OMDB: {$series->title} (IMDb: {$imdbId})");

            return $series;

        } catch (\Exception $e) {
            Log::error('OMDB Import Series Error: ' . $e->getMessage());
            return null;
        }
    }

    /**
     * Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø³Ù†Ø© Ù…Ù† Ø§Ù„Ù†Øµ
     */
    protected function extractYear(string $year): ?int
    {
        // Ù…Ø«Ø§Ù„: "2019" Ø£Ùˆ "2019â€“2024" Ø£Ùˆ "2019â€“"
        preg_match('/(\d{4})/', $year, $matches);
        return isset($matches[1]) ? (int)$matches[1] : null;
    }

    /**
     * Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù…Ø¯Ø© Ø¨Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚
     */
    protected function extractDuration(string $runtime): ?int
    {
        // Ù…Ø«Ø§Ù„: "148 min"
        preg_match('/(\d+)/', $runtime, $matches);
        return isset($matches[1]) ? (int)$matches[1] : null;
    }

    /**
     * Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… ÙƒØ±Ù‚Ù… Ø¹Ø´Ø±ÙŠ
     */
    protected function extractRating(string $rating): float
    {
        $rating = str_replace(',', '.', $rating);
        return (float)$rating;
    }

    /**
     * Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø±Ø§Ø¨Ø· Ø§Ù„Ø¨ÙˆØ³ØªØ±
     */
    protected function getPosterUrl(string $poster): ?string
    {
        return ($poster && $poster !== 'N/A') ? $poster : null;
    }

    /**
     * Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…ØªØ¹Ø¯Ø¯ (Bulk Import)
     */
    public function bulkImport(array $imdbIds, string $type, int $categoryId, int $languageId = 1): array
    {
        $results = [
            'success' => 0,
            'failed' => 0,
            'items' => [],
            'errors' => [],
        ];

        foreach ($imdbIds as $imdbId) {
            try {
                if ($type === 'movie') {
                    $item = $this->importMovie($imdbId, $categoryId, $languageId);
                } else {
                    $item = $this->importSeries($imdbId, $categoryId, $languageId);
                }

                if ($item) {
                    $results['success']++;
                    $results['items'][] = $item;
                } else {
                    $results['failed']++;
                    $results['errors'][] = "Failed to import: {$imdbId}";
                }

            } catch (\Exception $e) {
                $results['failed']++;
                $results['errors'][] = "{$imdbId}: {$e->getMessage()}";
            }
        }

        return $results;
    }
}
