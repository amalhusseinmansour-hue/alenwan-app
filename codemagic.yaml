  workflows:
    ios-release:
      name: ALENWAN PLAY - iOS Release
      max_build_duration: 60
      instance_type: mac_mini_m1

      triggering:
        events:
          - push
        branch_patterns:
          - pattern: main
            include: true

      environment:
        flutter: stable
        xcode: latest
        cocoapods: default
        ios_signing:
          distribution_type: app_store
          bundle_identifier: com.alenwanpla

      scripts:
        - name: Get Flutter packages
          script: flutter pub get

        - name: Install CocoaPods
          script: cd ios && pod install --repo-update

        - name: Set up code signing
          script: xcode-project use-profiles

        - name: Build IPA
          script: flutter build ipa --release

      artifacts:
        - build/ios/ipa/*.ipa
        - /tmp/xcodebuild_logs/*.log

      publishing:
        app_store_connect:
          auth: integration
          submit_to_testflight: true
          submit_to_app_store: false

